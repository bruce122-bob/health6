<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIåŠ©æ‰‹è¯Šæ–­ - She Haven</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .diagnostic-section {
            margin: 30px 0;
            padding: 20px;
            border-radius: 10px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
        }
        
        .diagnostic-section h3 {
            margin-top: 0;
            color: #333;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-ok {
            color: #28a745;
            font-weight: bold;
        }
        
        .status-error {
            color: #dc3545;
            font-weight: bold;
        }
        
        .status-warning {
            color: #ffc107;
            font-weight: bold;
        }
        
        .test-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            margin: 5px;
        }
        
        .test-button:hover {
            opacity: 0.9;
        }
        
        .log-area {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .refresh-btn {
            background: #28a745;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            display: block;
            margin: 30px auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ AIåŠ©æ‰‹è¯Šæ–­å·¥å…·</h1>
        
        <div class="diagnostic-section">
            <h3>ğŸ“ æ–‡ä»¶åŠ è½½çŠ¶æ€</h3>
            <div class="status-item">
                <span>ai-assistant.css</span>
                <span id="css-status" class="status-warning">æ£€æŸ¥ä¸­...</span>
            </div>
            <div class="status-item">
                <span>ai-assistant.js</span>
                <span id="js-status" class="status-warning">æ£€æŸ¥ä¸­...</span>
            </div>
            <div class="status-item">
                <span>Font Awesomeå›¾æ ‡</span>
                <span id="fa-status" class="status-warning">æ£€æŸ¥ä¸­...</span>
            </div>
        </div>
        
        <div class="diagnostic-section">
            <h3>ğŸ¤– AIåŠ©æ‰‹å¯¹è±¡çŠ¶æ€</h3>
            <div class="status-item">
                <span>window.lumaAssistant</span>
                <span id="assistant-status" class="status-warning">æ£€æŸ¥ä¸­...</span>
            </div>
            <div class="status-item">
                <span>LumaAIAssistantç±»</span>
                <span id="class-status" class="status-warning">æ£€æŸ¥ä¸­...</span>
            </div>
            <div class="status-item">
                <span>DOMå…ƒç´ åˆ›å»º</span>
                <span id="dom-status" class="status-warning">æ£€æŸ¥ä¸­...</span>
            </div>
        </div>
        
        <div class="diagnostic-section">
            <h3>ğŸŒ ç½‘ç»œå’ŒAPIçŠ¶æ€</h3>
            <div class="status-item">
                <span>ç½‘ç»œè¿æ¥</span>
                <span id="network-status" class="status-warning">æ£€æŸ¥ä¸­...</span>
            </div>
            <div class="status-item">
                <span>APIé…ç½®</span>
                <span id="api-config-status" class="status-warning">æ£€æŸ¥ä¸­...</span>
            </div>
            <div class="status-item">
                <span>CORSè®¾ç½®</span>
                <span id="cors-status" class="status-warning">æ£€æŸ¥ä¸­...</span>
            </div>
        </div>
        
        <div class="diagnostic-section">
            <h3>ğŸ”§ åŠŸèƒ½æµ‹è¯•</h3>
            <button class="test-button" onclick="testChatOpen()">æµ‹è¯•èŠå¤©çª—å£æ‰“å¼€</button>
            <button class="test-button" onclick="testMessageSend()">æµ‹è¯•æ¶ˆæ¯å‘é€</button>
            <button class="test-button" onclick="testAPICall()">æµ‹è¯•APIè°ƒç”¨</button>
            <button class="test-button" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
        
        <button class="refresh-btn" onclick="runFullDiagnostic()">ğŸ”„ è¿è¡Œå®Œæ•´è¯Šæ–­</button>
        
        <div class="diagnostic-section">
            <h3>ğŸ“‹ è¯Šæ–­æ—¥å¿—</h3>
            <div class="log-area" id="diagnostic-log">
                ç­‰å¾…è¯Šæ–­å¼€å§‹...
            </div>
        </div>
    </div>
    
    <!-- å¼•å…¥AIåŠ©æ‰‹ -->
    <link rel="stylesheet" href="ai-assistant.css">
    <script src="ai-assistant.js"></script>
    
    <script>
        let diagnosticLog = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            diagnosticLog.push(logEntry);
            updateLogDisplay();
            console.log(logEntry);
        }
        
        function updateLogDisplay() {
            const logArea = document.getElementById('diagnostic-log');
            logArea.textContent = diagnosticLog.join('\n');
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        function clearLogs() {
            diagnosticLog = [];
            updateLogDisplay();
        }
        
        function setStatus(elementId, status, message) {
            const element = document.getElementById(elementId);
            element.className = `status-${status}`;
            element.textContent = message;
        }
        
        function checkFileLoading() {
            log('å¼€å§‹æ£€æŸ¥æ–‡ä»¶åŠ è½½çŠ¶æ€...');
            
            // æ£€æŸ¥CSS
            const cssLinks = document.querySelectorAll('link[href*="ai-assistant.css"]');
            if (cssLinks.length > 0) {
                setStatus('css-status', 'ok', 'âœ… å·²åŠ è½½');
                log('ai-assistant.css æ–‡ä»¶å·²æ­£ç¡®å¼•å…¥');
            } else {
                setStatus('css-status', 'error', 'âŒ æœªæ‰¾åˆ°');
                log('ai-assistant.css æ–‡ä»¶æœªæ‰¾åˆ°', 'error');
            }
            
            // æ£€æŸ¥JS
            const jsScripts = document.querySelectorAll('script[src*="ai-assistant.js"]');
            if (jsScripts.length > 0) {
                setStatus('js-status', 'ok', 'âœ… å·²åŠ è½½');
                log('ai-assistant.js æ–‡ä»¶å·²æ­£ç¡®å¼•å…¥');
            } else {
                setStatus('js-status', 'error', 'âŒ æœªæ‰¾åˆ°');
                log('ai-assistant.js æ–‡ä»¶æœªæ‰¾åˆ°', 'error');
            }
            
            // æ£€æŸ¥Font Awesome
            const faLinks = document.querySelectorAll('link[href*="font-awesome"]');
            if (faLinks.length > 0) {
                setStatus('fa-status', 'ok', 'âœ… å·²åŠ è½½');
                log('Font Awesome å›¾æ ‡åº“å·²æ­£ç¡®å¼•å…¥');
            } else {
                setStatus('fa-status', 'warning', 'âš ï¸ æœªæ‰¾åˆ°');
                log('Font Awesome å›¾æ ‡åº“æœªæ‰¾åˆ°', 'warning');
            }
        }
        
        function checkAIAssistant() {
            log('å¼€å§‹æ£€æŸ¥AIåŠ©æ‰‹å¯¹è±¡çŠ¶æ€...');
            
            // æ£€æŸ¥LumaAIAssistantç±»
            if (typeof LumaAIAssistant !== 'undefined') {
                setStatus('class-status', 'ok', 'âœ… å·²å®šä¹‰');
                log('LumaAIAssistant ç±»å·²æ­£ç¡®å®šä¹‰');
            } else {
                setStatus('class-status', 'error', 'âŒ æœªå®šä¹‰');
                log('LumaAIAssistant ç±»æœªå®šä¹‰', 'error');
            }
            
            // æ£€æŸ¥window.lumaAssistantå®ä¾‹
            if (typeof window.lumaAssistant !== 'undefined') {
                setStatus('assistant-status', 'ok', 'âœ… å·²åˆå§‹åŒ–');
                log('window.lumaAssistant å®ä¾‹å·²æ­£ç¡®åˆå§‹åŒ–');
            } else {
                setStatus('assistant-status', 'error', 'âŒ æœªåˆå§‹åŒ–');
                log('window.lumaAssistant å®ä¾‹æœªåˆå§‹åŒ–', 'error');
            }
            
            // æ£€æŸ¥DOMå…ƒç´ 
            const chatButton = document.getElementById('ai-chat-button');
            const chatWidget = document.getElementById('ai-chat-widget');
            if (chatButton && chatWidget) {
                setStatus('dom-status', 'ok', 'âœ… å·²åˆ›å»º');
                log('AIåŠ©æ‰‹DOMå…ƒç´ å·²æ­£ç¡®åˆ›å»º');
            } else {
                setStatus('dom-status', 'error', 'âŒ æœªåˆ›å»º');
                log('AIåŠ©æ‰‹DOMå…ƒç´ æœªåˆ›å»º', 'error');
            }
        }
        
        function checkNetworkAndAPI() {
            log('å¼€å§‹æ£€æŸ¥ç½‘ç»œå’ŒAPIçŠ¶æ€...');
            
            // æ£€æŸ¥ç½‘ç»œè¿æ¥
            if (navigator.onLine) {
                setStatus('network-status', 'ok', 'âœ… å·²è¿æ¥');
                log('ç½‘ç»œè¿æ¥æ­£å¸¸');
            } else {
                setStatus('network-status', 'error', 'âŒ æœªè¿æ¥');
                log('ç½‘ç»œè¿æ¥å¼‚å¸¸', 'error');
            }
            
            // æ£€æŸ¥APIé…ç½®
            if (typeof AI_CONFIG !== 'undefined') {
                setStatus('api-config-status', 'ok', 'âœ… å·²é…ç½®');
                log('AI_CONFIG é…ç½®å¯¹è±¡å·²å®šä¹‰');
                log(`APIç«¯ç‚¹: ${AI_CONFIG.apiEndpoint}`);
                log(`æµ‹è¯•æ¨¡å¼: ${AI_CONFIG.testMode ? 'å¼€å¯' : 'å…³é—­'}`);
            } else {
                setStatus('api-config-status', 'error', 'âŒ æœªé…ç½®');
                log('AI_CONFIG é…ç½®å¯¹è±¡æœªå®šä¹‰', 'error');
            }
            
            // CORSæ£€æŸ¥ï¼ˆç®€å•æ£€æŸ¥ï¼‰
            setStatus('cors-status', 'warning', 'âš ï¸ éœ€æµ‹è¯•');
            log('CORSè®¾ç½®éœ€è¦é€šè¿‡å®é™…APIè°ƒç”¨æµ‹è¯•');
        }
        
        function testChatOpen() {
            log('æµ‹è¯•èŠå¤©çª—å£æ‰“å¼€åŠŸèƒ½...');
            if (window.lumaAssistant && typeof window.lumaAssistant.openChat === 'function') {
                try {
                    window.lumaAssistant.openChat();
                    log('âœ… èŠå¤©çª—å£æ‰“å¼€æˆåŠŸ');
                } catch (error) {
                    log(`âŒ èŠå¤©çª—å£æ‰“å¼€å¤±è´¥: ${error.message}`, 'error');
                }
            } else {
                log('âŒ AIåŠ©æ‰‹æœªåˆå§‹åŒ–æˆ–openChatæ–¹æ³•ä¸å­˜åœ¨', 'error');
            }
        }
        
        function testMessageSend() {
            log('æµ‹è¯•æ¶ˆæ¯å‘é€åŠŸèƒ½...');
            if (window.lumaAssistant && typeof window.lumaAssistant.addMessage === 'function') {
                try {
                    window.lumaAssistant.addMessage('è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯', 'user');
                    window.lumaAssistant.addMessage('è¿™æ˜¯AIçš„æµ‹è¯•å›å¤', 'ai');
                    log('âœ… æ¶ˆæ¯å‘é€åŠŸèƒ½æ­£å¸¸');
                } catch (error) {
                    log(`âŒ æ¶ˆæ¯å‘é€åŠŸèƒ½å¼‚å¸¸: ${error.message}`, 'error');
                }
            } else {
                log('âŒ AIåŠ©æ‰‹æœªåˆå§‹åŒ–æˆ–addMessageæ–¹æ³•ä¸å­˜åœ¨', 'error');
            }
        }
        
        async function testAPICall() {
            log('æµ‹è¯•APIè°ƒç”¨åŠŸèƒ½...');
            if (window.lumaAssistant && typeof window.lumaAssistant.getTestResponse === 'function') {
                try {
                    const response = await window.lumaAssistant.getTestResponse('æµ‹è¯•æ¶ˆæ¯');
                    log('âœ… æµ‹è¯•æ¨¡å¼APIè°ƒç”¨æˆåŠŸ');
                    log(`å“åº”å†…å®¹: ${response.substring(0, 100)}...`);
                } catch (error) {
                    log(`âŒ APIè°ƒç”¨å¤±è´¥: ${error.message}`, 'error');
                }
            } else {
                log('âŒ AIåŠ©æ‰‹æœªåˆå§‹åŒ–æˆ–APIæ–¹æ³•ä¸å­˜åœ¨', 'error');
            }
        }
        
        function runFullDiagnostic() {
            log('=== å¼€å§‹è¿è¡Œå®Œæ•´è¯Šæ–­ ===');
            clearLogs();
            
            setTimeout(() => {
                checkFileLoading();
                checkAIAssistant();
                checkNetworkAndAPI();
                log('=== è¯Šæ–­å®Œæˆ ===');
            }, 500);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œè¯Šæ–­
        window.addEventListener('load', () => {
            setTimeout(runFullDiagnostic, 1000);
        });
    </script>
</body>
</html> 